#include <stddef.h>

#ifdef PRELOAD_INCLUDED
extern const char preload_source[];
extern const size_t preload_source_len;

const char preload_source[] =
"alias bool = i32;\n"
"\n"
"const true  := cast(bool) 1;\n"
"const false := cast(bool) 0;\n"
"\n"
"fun exit(code: i32);\n"
"fun puts(str: u8*): i32;\n"
"fun strlen(str: u8*): i32;\n"
"fun malloc(size: i32): i8*;\n"
"fun memcmp(v1: void*, v2: void*, len: u32): i32;\n"
"fun printf(fmt: u8*, ..): i32;\n"
"\n"
"fun __atcc_init_globals(); // Auto-generated by the compiler to initialize global variables\n"
"\n"
"fun __atcc_string_equals(a: string, b: string): i32 {\n"
"    if (a.length != b.length) return 0;\n"
"\n"
"    if (memcmp(a.data, b.data, a.length) == 0)\n"
"        return 1;\n"
"\n"
"    return 0;\n"
"}\n"
"\n"
"fun __atcc_memset(ptr: void*, value: i32, num: u32): void* {\n"
"    bytes := cast(u8*) ptr;\n"
"    for (i := 0; i < num; i += 1)\n"
"        bytes[i] = cast(u8) value;\n"
"    return ptr;\n"
"}\n"
"\n"
"fun __atcc_start(argc: i32, argv: u8**): i32 {\n"
"    __atcc_init_globals();\n"
"\n"
"    args: string[*];\n"
"    args.data = cast(string*) malloc(argc * 16);\n"
"    args.length = cast(u32) argc;\n"
"\n"
"    for (i := 0; i < cast(u32) argc; i += 1) {\n"
"        arg := &args[i];\n"
"\n"
"        arg.data = argv[i];\n"
"        arg.length = cast(u32) strlen(argv[i]);\n"
"    }\n"
"\n"
"    return Main(args);\n"
"}\n"
"\n"
"fun assert(condition: bool, message: string) {\n"
"    if (!condition) {\n"
"        puts(cast(u8*) message.data);\n"
"        exit(1);\n"
"    }\n"
"}\n"
"\n"
"fun print(message: string) {\n"
"    puts(cast(u8*) message.data);\n"
"}";

const size_t preload_source_len = sizeof(preload_source) - 1;
#endif
